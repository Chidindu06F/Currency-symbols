<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Currency symbols</title>
    <style>
      :root {
        --bg: #0b0f14;
        --surface: #11141a;
        --item-hover: rgba(255, 255, 255, 0.03);
        --radius: 10px;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
        color-scheme: dark;
      }

      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        padding: 12px;
        box-sizing: border-box;
        background: linear-gradient(180deg, var(--bg), #07090b 120%);
        color: #e8e8e8;
        -webkit-font-smoothing: antialiased;
        overflow: hidden; /* hide outer scrollbar */
      }

      .card {
        width: 340px;
        max-width: calc(
          100vw - 24px
        ); /* keep card inside viewport / container */
        box-sizing: border-box;
        background: var(--panel);
        border-radius: 12px;
        padding: 12px 12px 28px 12px; /* extra bottom padding so last item isn't cut off */
        overflow: hidden; /* prevent children from visually overflowing */
        box-shadow: 0 6px 24px rgba(2, 6, 23, 0.6);
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      .title {
        font-size: 15px;
        font-weight: 600;
        color: #dff7ea;
        margin-bottom: 10px; /* space between heading and subheading */
      }
      .subtitle {
        font-size: 12px;
        color: var(--muted);
      }

      .search {
        margin-top: 12px;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .search input[type="search"] {
        flex: 1;
        background: var(--surface);
        border: 1px solid rgba(255, 255, 255, 0.03);
        color: inherit;
        padding: 10px 12px;
        border-radius: 8px;
        outline: none;
        font-size: 13px;
      }

      .list {
        margin-top: 12px;
        max-height: 360px;
        overflow: auto;
        padding: 6px 6px 28px 6px; /* extra bottom padding so last item is visible */
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 10px;
        border-radius: 8px;
        background: transparent;
        cursor: pointer;
        transition: background 0.12s, transform 0.06s;
        border: 1px solid transparent;
      }
      .item:focus {
        outline: none;
        box-shadow: inset 0 0 0 1px rgba(61, 217, 167, 0.08);
      }
      .item:hover {
        background: var(--item-hover);
        transform: translateY(-1px);
      }

      .left {
        display: flex;
        align-items: center;
        flex: 1 1 auto; /* allow left column to shrink when available width is small */
        min-width: 0; /* allow text to truncate inside flex */
      }

      .meta {
        display: flex;
        flex-direction: column;
        min-width: 0; /* enable truncation on long country names */
      }
      .country {
        font-size: 13px;
        font-weight: 500;
        color: #d8deda;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .code {
        font-size: 12px;
        color: var(--muted);
        margin-top: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .symbol {
        font-weight: 700;
        font-size: 18px;
        color: var(--accent);
        min-width: 48px;
        text-align: right;
        flex-shrink: 0;
      }

      .empty {
        padding: 18px;
        text-align: center;
        color: var(--muted);
      }

      .footer {
        margin-top: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .btn {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.04);
        color: var(--muted);
        padding: 8px 10px;
        border-radius: 8px;
        cursor: pointer;
      }
      .btn.primary {
        background: linear-gradient(
          90deg,
          rgba(61, 217, 167, 0.12),
          rgba(24, 160, 251, 0.08)
        );
        color: var(--accent);
        border: none;
      }

      /* hide scrollbar while preserving scroll behavior */
      body::-webkit-scrollbar {
        display: none;
        width: 0;
        height: 0;
      }
      .list {
        -ms-overflow-style: none !important; /* IE/Edge */
        scrollbar-width: none !important; /* Firefox */
      }
      .list::-webkit-scrollbar {
        display: none !important;
        width: 0 !important;
        height: 0 !important;
      }
    </style>
  </head>
  <body>
    <div class="card" role="dialog" aria-label="Insert currency symbol">
      <div class="header">
        <div>
          <div class="title">Currency Symbols</div>
          <div class="subtitle">
            Select a text layer, then select a country to insert its symbol
          </div>
        </div>
      </div>

      <div class="search">
        <input
          id="query"
          type="search"
          placeholder="Search country, code, or symbol"
          autocomplete="off"
        />
      </div>

      <div id="list" class="list" role="list"></div>

      <!-- footer removed as requested -->
    </div>

    <script>
      // Modern dark-mode UI for currency insertion
      let currencies = [];
      let selectedIndex = -1;

      const listEl = document.getElementById("list");
      const queryEl = document.getElementById("query");

      function escapeHtml(s) {
        return String(s || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      function render(filtered) {
        listEl.innerHTML = "";
        if (!filtered || filtered.length === 0) {
          const e = document.createElement("div");
          e.className = "empty";
          e.textContent = "No results";
          listEl.appendChild(e);
          return;
        }

        filtered.forEach((c, idx) => {
          const item = document.createElement("div");
          item.className = "item";
          item.tabIndex = 0;
          item.dataset.index = idx;

          item.innerHTML = `
            <div class="left">
              <div class="meta"><div class="country">${escapeHtml(
                c.country
              )}</div><div class="code">${escapeHtml(c.code)}</div></div>
            </div>
            <div class="symbol">${escapeHtml(c.symbol)}</div>
          `;

          item.addEventListener("click", () => selectCurrency(c));
          item.addEventListener("keydown", (e) => {
            if (e.key === "Enter") selectCurrency(c);
          });

          listEl.appendChild(item);
        });
        // reset selection index when list changes
        selectedIndex = -1;
      }

      function selectCurrency(c) {
        parent.postMessage(
          {
            pluginMessage: {
              type: "insert-symbol",
              symbol: c.symbol,
              code: c.code,
            },
          },
          "*"
        );
      }

      function normalize(s) {
        return (s || "").toString().toLowerCase();
      }
      function filter(q) {
        const nq = normalize(q);
        if (!nq) return currencies.slice();
        return currencies.filter(
          (c) =>
            normalize(c.country).includes(nq) ||
            normalize(c.code).includes(nq) ||
            normalize(c.symbol).includes(nq)
        );
      }

      onmessage = (event) => {
        const msg = event.data && (event.data.pluginMessage || event.data);
        if (!msg) return;
        if (msg.type === "currencies") {
          currencies = msg.currencies || [];
          render(currencies);
        }
      };

      queryEl.addEventListener("input", (e) => render(filter(e.target.value)));

      // keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k") {
          e.preventDefault();
          queryEl.focus();
          queryEl.select();
        }
        // navigate list
        if (e.key === "ArrowDown") {
          e.preventDefault();
          focusNext();
        }
        if (e.key === "ArrowUp") {
          e.preventDefault();
          focusPrev();
        }
        if (e.key === "Enter" && document.activeElement === queryEl) {
          e.preventDefault(); // insert first if available
          const list = listEl.querySelectorAll(".item");
          if (list.length > 0) list[0].click();
        }
      });

      function focusNext() {
        const items = Array.from(listEl.querySelectorAll(".item"));
        if (items.length === 0) return;
        selectedIndex = Math.min(items.length - 1, selectedIndex + 1);
        items[selectedIndex].focus();
      }
      function focusPrev() {
        const items = Array.from(listEl.querySelectorAll(".item"));
        if (items.length === 0) return;
        selectedIndex = Math.max(0, selectedIndex - 1);
        items[selectedIndex].focus();
      }

      // No footer buttons in this UI; insertion is performed by clicking an item or pressing Enter.

      // initial focus
      queryEl.focus();
    </script>
  </body>
</html>
